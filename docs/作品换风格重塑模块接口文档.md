## **作品换风格重塑模块接口文档（整合版）**

------

#### **1. 提交图片与风格转换请求接口**

**1.1 基本信息**

- **请求路径**：`/generate`
- **请求方式**：`POST`
- **接口描述**：用户一次性上传图片和风格提示词，触发AI生成风格化图片，并直接返回生成结果（同步处理）。

**1.2 请求参数**

- **参数格式**：`multipart/form-data`（支持同时上传文件和表单字段）
- **参数说明**：

| 参数名      | 类型   | 是否必须 | 备注                               |
| :---------- | :----- | :------- | :--------------------------------- |
| file        | file   | 必须     | 用户上传的图片文件（支持JPG/PNG）  |
| stylePrompt | string | 必须     | 风格提示词（如“水墨画风格，留白”） |

**请求示例**：

```bash
curl -X POST \
  -F "file=@/path/to/image.jpg" \
  -F "stylePrompt=印象派，高饱和度" \
  http://api.example.com/generate
```

**1.3 响应数据**

- **参数格式**：`application/json`
- **参数说明**：

| 参数名      | 类型   | 是否必须 | 备注                                                  |
| :---------- | :----- | :------- | :---------------------------------------------------- |
| code        | number | 必须     | 响应码（1成功，0失败）                                |
| msg         | string | 非必须   | 提示信息（如失败原因）                                |
| data        | object | 必须     | 返回的数据                                            |
| !-status    | string | 必须     | 任务状态（`completed`成功，`failed`失败）             |
| !-resultUrl | string | 非必须   | 生成图片的临时下载链接（仅当状态为`completed`时返回） |

**响应数据样例**：

```json
{
    "code": 1,
    "msg": "生成成功",
    "data": {
        "status": "completed",
        "resultUrl": "https://cdn.example.com/generated/img_987654321.png"
    }
}
```

------

### **关键设计说明**

1. **同步处理逻辑**

   - 用户上传图片和提示词后，**后端立即触发AI处理**，并保持HTTP连接等待生成完成。
   - **适用场景**：AI处理时间较短（建议控制在10秒内），避免HTTP请求超时（默认30秒-2分钟，因服务器配置而异）。

2. **临时文件管理**

   - 生成的图片在服务器留存 **1小时** 后自动删除，临时链接过期后不可访问。
   - 若需长期保存结果，需用户主动下载或扩展功能（当前需求不涉及）。

3. **错误处理**

   - 若AI处理失败（如风格不支持、图片损坏），返回`status: failed`并提供错误码和提示信息。

   - **错误码扩展**：

     | 错误码 | 含义       | 典型场景                     |
     | :----- | :--------- | :--------------------------- |
     | 0      | 请求失败   | 图片格式不支持、提示词为空等 |
     | 1001   | AI生成超时 | 处理时间超过服务器等待阈值   |
     | 1002   | 风格不支持 | 模型无法识别提示词风格       |